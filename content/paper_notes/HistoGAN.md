---
title: "HistoGAN: Controlling Colors of GAN-Generated and Real Images via Color Histograms"
date: 2021-10-06
draft: false
---

æ–¹æ³•ä¸å±€é™æ–¼åŒå€‹domainä¸‹çš„é¡è‰²è½‰æ›ï¼Œè€Œæ˜¯å–®ç´”å°±color histogramä¾†è½‰æ›é¡è‰²ï¼Œè€Œå…§å®¹ä¿ç•™

# Main idea

## Scheme

åœ¨åšåœ–ç‰‡çš„é¢¨æ ¼è½‰æ›æ™‚ï¼Œç‰¹åˆ¥é—œæ³¨æ–¼å°é¡è‰²çš„æ§åˆ¶ï¼ˆå¯ä»¥è¦–ç‚ºStyle transferçš„ä¸€å€‹sub-categoryï¼‰

## Previous work

## Problems (motivation)

- åŸºæ–¼ä¸€å¼µé¢¨æ ¼ç›®æ¨™åœ–åšè½‰æ›
    - å¯èƒ½æœƒå½±éŸ¿åˆ°è¢«è½‰æ›çš„å…§å®¹ç´°ç¯€ï¼ˆç´‹ç†ã€è‰²èª¿ï¼‰
- è½‰æ›çš„å“è³ªå¥½å£éå¸¸ä¾è³´inputå’Œtargetåœ–ç‰‡é–“èªæ„ç›¸ä¼¼æ€§ï¼ˆæ˜¯å¦åœ¨åŒä¸€å€‹domainï¼‰
    - æƒ³è¦æœ‰å¥½çš„é¢¨æ ¼è½‰æ›æ•ˆæœå°±å¿…é ˆåœ¨åŒä¸€å€‹domainä¸‹

## Method

- åªè—‰ç”±color histogramä¾†å”åŠ©deep networkçš„æ•ˆæœ
    - ç”±æ­¤å°±å¯ä»¥å¾ä»»æ„çš„domainä¸­æå–è‰²å½©

## Result

---

# Abstract

<aside>
ğŸ’¡ Target: intuitively controlled the appearance(color) of images generated by GANs

</aside>

- HistoGAN
    - based on StyleGAN architecture
    - control the GAN-generated images specified by a target color histogram feature
- ReHistoGAN
    - expend HistoGAN to recolor the generated image
    - encoder
    - unsupervised
    - keep the original images content while changing the colors based on the given target histogram

# 1. Motivation and Related work

é¡è‰²ç›´æ–¹åœ–æ˜¯å€‹å¾ˆå¥½ç”¨ä¾†è¡¨é”åœ–ç‰‡é¡è‰²çš„æ–¹æ³•ï¼Œæœ‰è¨±å¤šç¨®ä¸åŒçš„é¡è‰²ç›´æ–¹åœ–ä¾†è¡¨é”é¡è‰²åˆ†ä½ˆ

- 3D histogram
- 2D histogram
- color palette
- color triad

**å‹•æ©Ÿ**

è¿‘æœŸçš„æ·±åº¦å­¸ç¿’æ¨¡å‹åœ¨åšé¡è‰²è½‰æ›æ™‚éƒ½æ˜¯é ä¸€å¼µç›®æ¨™ç¯„ä¾‹é€²è¡Œè½‰æ›ï¼Œä¸”æœƒåœ¨åŒä¸€å€‹domainä¸‹ã€‚
ä¸åŒçš„ç›®æ¨™ç¯„ä¾‹ï¼ˆtarget imageï¼‰æœƒå°è‡´ç”Ÿæˆå‡ºçš„åœ–ç‰‡æ•ˆæœä¸åŒï¼Œæœ‰æ™‚å€™ä¸åªæ›´æ”¹é¡è‰²ï¼Œé€£è³ªåœ°ã€ç´‹ç†éƒ½æœƒè®Šå‹•

**æ­¤ç¯‡ç‰¹è‰²**

åªå°ˆæ³¨æ–¼æ§åˆ¶åœ–ç‰‡çš„é¡è‰²ç‰¹å¾µï¼Œå–®ç´”è—‰ç”±é¡è‰²ç›´æ–¹åœ–çš„è³‡è¨Šä¾†å”åŠ©DLæ¨¡å‹

**æ§åˆ¶GANç”Ÿæˆåœ–ç‰‡çš„é¡è‰²**

- GANè¢«è¦–ç‚ºé»‘ç›’å­èƒ½å°‡ä¸€å€‹ç°¡å–®çš„åˆ†ä½ˆè½‰æ›æˆä¸€å€‹æœ‰æ„ç¾©çš„ç¯„ç–‡ï¼Œä½†ä¸¦æ²’æœ‰èƒ½åŠ›æ§åˆ¶ç´°ç¯€
    - ç›´åˆ°StyleGANå‡ºç¾æ‰é–‹å§‹å¯ä»¥æ§åˆ¶æ›´ç´°ç¯€çš„é¢¨æ ¼
    - ä¸€é–‹å§‹ç™¼å±•äº†StyleGANç”¨ä¾†å°ç”Ÿæˆçš„åœ–ç‰‡é¢¨æ ¼é€²è¡Œé™åˆ¶ï¼ŒStyle mixing
    - ä½¿ç”¨ä¸åŒçš„latent space vectorsä¾†æ§åˆ¶é¢¨æ ¼
- é”åˆ°æ­¤ç›®æ¨™æœƒæœ‰è¨±å¤šçš„è¨ˆç®—èŠ±è²»ï¼Œä¹Ÿæœ‰äººå¦å¤–è¨“ç·´ä¸€å€‹encoder-generatorç¶²è·¯ä¾†å­¸ç¿’ä¸€å€‹æ˜ å°„é—œä¿‚
å°‡ç›®æ¨™é¢¨æ ¼è½‰æ›æˆlatent code
- æœ¬ç¯‡è«–æ–‡å¸Œæœ›ç°¡åŒ–è½‰æ›éç¨‹ï¼Œå–®ç´”ä½¿ç”¨color histogramä¾†ç•¶ä½œinputè½‰æ›é¢¨æ ¼
ä¸å—domainçš„é™åˆ¶ï¼Œè®“ä¸åŒdomainçš„åœ–ç‰‡ä¹Ÿå¯ä»¥é”åˆ°ç›¸åŒçš„è‰²å½©åˆ†ä½ˆ

**é‡æ–°åœ¨çœŸå¯¦åœ–ç‰‡ä¸Šè‘—è‰²**

- åˆ©ç”¨å‰ä¸€å€‹è¨“ç·´å¥½çš„GANç¹¼çºŒä½œå»¶ä¼¸æ‡‰ç”¨
- å®Œå…¨éç›£ç£å­¸ç¿’
- æ¨¡å‹è¢«è¨“ç·´èƒ½å¤ å°é¡è‰²ç›´æ–¹åœ–æå–ç‰¹å¾µèˆ‡è³‡è¨Š
- å¯ä»¥ä¸ç”¨çµ¦å®šä¸€å€‹ç›®æ¨™é¡è‰²ç›´æ–¹åœ–å°±èƒ½è‡ªå‹•è‘—è‰²
è¼ƒå°‘ç ”ç©¶
- è¼¸å…¥ä¸€å¼µçœŸå¯¦å­˜åœ¨çš„åœ–èˆ‡ä¸€å€‹target histogramå°±å¯ä»¥è½‰æ›é¡è‰²

# 2. HistoGAN

é¦–å…ˆå…ˆä»‹ç´¹æœ¬è«–æ–‡æ˜¯ä½¿ç”¨histrgramä»€éº¼æ¨£çš„ç‰¹å¾µï¼Œå†ä¾†æœƒè¨è«–é‡å°æ–¼StyleGANçš„ä¸€äº›å°æ›´å‹•ï¼Œæœ€å¾Œæœƒè§£é‡‹æ€éº¼æ“´å±•è©²æ¨¡å‹ä¾†å°åœ–ç‰‡åšé‡æ–°ä¸Šè‰²çš„å‹•ä½œ

## 2.1. Histogram feature

- ä½¿ç”¨log-chromaçš„ç‰¹æ€§
    - å°æ–¼å…‰äº®çš„è®ŠåŒ–æœ‰æ›´å¥½çš„ä¸ä¾¿æ€§
    - ä¸”æ˜¯å¯å¾®åˆ†çš„
- ç‰¹å¾µå°±æ˜¯ä¸€å¼µåœ–ç‰‡çš„2Dç›´æ–¹åœ–æ˜ å°„åˆ°log-chromaç©ºé–“
    - æ­¤2Dç›´æ–¹åœ–æ˜¯ç”±$uv$ä¾†è¡¨é”
    - ä½¿ç”¨$uv$ä¾†è¡¨é”çš„é¡è‰²ç©ºé–“æœƒæ¯”$rbg$ä¾†çš„ç·Šæ¹Š
- log-chromaç©ºé–“æ˜¯é¸æ“‡ä¸€å€‹é¡è‰²ä½œç‚ºåŸºåº•ä¸¦ç”±å¦å¤–å…©å€‹é¡è‰²ä½œæ­¸ä¸€åŒ–ï¼Œå¦‚æ­¤ä¹Ÿå¯ä»¥è§€å¯Ÿåˆ°ä¸»è‰²çš„å¼·åº¦
å¯ä»¥é¸æ“‡ä¸åŒé¡è‰²ï¼Œå› æ­¤ç‰¹å¾µåœ–æœƒæ˜¯$H=h\times h\times 3$ çš„å¼µ
    
    [The importance of the normalizing channel in log-chromaticity space](https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6466987)
    
- histgramçš„è¨ˆç®—æ–¹æ³•
    - ä¸€å¼µçµ¦å®šçš„input $I$ å…ˆè½‰æ›æˆlog-chromaç©ºé–“
    - èˆ‰ä¾‹é¸æ“‡Rç‚ºä¸»è‰²ï¼Œä¸¦å°G, Bæ­¸ä¸€
    $I_{uR}(x)=\log{\frac{I_R(x)+\epsilon}{I_G(x)+\epsilon}}$ $I_{vR}(x)=\log{\frac{I_R(x)+\epsilon}{I_B(x)+\epsilon}}$ 
    å…¶ä¸­$x$ç‚ºpixel index

## 2.2. Color-controlled Image Generation

- æƒ³æ³•æ˜¯å°‡histogram featureåˆä½µè‡³StyleGANçš„æ¶æ§‹ä¸­ä½¿ç”¨
    - å·®åˆ¥åœ¨æ–¼åœ¨æœ€å¾Œä¸€å€‹blockï¼ŒåŸæœ¬æ˜¯å°‡å°‡é¢¨æ ¼åœ–è½‰æˆStyle vectorå¾Œå†è½‰æˆlatent codeä¾†ä½¿ç”¨ï¼Œä½†æœ¬ç¯‡è«–æ–‡æ˜¯æœ¬é¢¨æ ¼åœ–æ‹¿æ‰ï¼Œæ›æˆHistorgramåœ–ï¼Œä¸¦ä½¿ç”¨ä¸€å€‹projection networkå†è½‰æˆlatent code
    - projected into a lower-dimentional representationæ˜¯ä»€éº¼æ„æ€ï¼Ÿ
    
    ![Histo æˆªåœ– 2021-10-07 ä¸‹åˆ1.57.41.png](../paper_resources/HistoGAN/æˆªåœ–_2021-10-07_ä¸‹åˆ1.57.41.png)
    
- æ­¤ç¶²è·¯æ¶æ§‹æœ‰8å€‹layer
    - ç¬¬ä¸€å€‹layeræœ‰1024å€‹ç¥ç¶“å…ƒï¼Œå…¶ä»–7å€‹å‰‡æœ‰512å€‹ç¥ç¶“å…ƒ
    - æ©˜è‰²çš„to latentå€å¡Šæœƒå°‡histogram featureæ˜ å°„åˆ°ä¸€å€‹latent spaceï¼Œè¼¸å‡ºç‚º$2^nm$ç¥ç¶“å…ƒ  $n$ç‚ºblockç·¨è™Ÿï¼Œ$m$ ç‚ºä¸€å€‹æ§åˆ¶ç¶²è·¯å®¹é‡çš„è®Šæ•¸
- Color loss
    - ä½¿ç”¨Hellinger distance
    - $C(H_g,H_t)=\frac{1}{\sqrt{2}}\parallel H^{\frac{1}{2}}_g-H^{\frac{1}{2}}_{t} \parallel_{2}$
    - $\parallel \cdot \parallel_2$ æ˜¯æ¨™æº–æ­å¼norm (ä¼¼ä¹å°±æ˜¯pixel-wiseçš„å¹³æ–¹æ ¹è™Ÿ)
- Generatorçš„loss
    - $\mathcal{L}=D(I_g)+\alpha C(H_g,H_t)$
    - $I_g$ æ˜¯generatorç”Ÿå‡ºçš„åœ–ç‰‡
    - $D(\cdot)$ æ˜¯å€‹discriminatorè² è²¬ç”¢å‡ºä¸€å€‹scalar feature
- è¨“ç·´ç´°ç¯€
    - å› ç‚ºlosså‡½æ•¸æ˜¯å¯å¾®åˆ†çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨SGDä¾†æ›´æ–° ï¼ˆStochastic Gradient Descentï¼‰
    - è¨“ç·´éç¨‹ä¸­éœ€è¦ä¸åŒçš„target histogram
        - éš¨æ©Ÿåœ¨training setä¸­é¸æ“‡å…©å¼µåœ–ä¸¦è¨ˆç®—å…¶histogram $H_1, H_2$
        - ä¸¦éš¨æ©Ÿçš„å°‡å…©å€‹histogramé€²è¡Œæ’å€¼
        - $H_t=\delta H_1+(1-\delta)H_2$
        $\delta \sim U(0,1)$
        - æœƒéœ€è¦ä¸€ç›´ç”¢ç”Ÿä¸åŒçš„target histogramæ˜¯ç‚ºäº†å¢åŠ histogramçš„è®Šç•°æ€§ï¼Œæ¸›å°‘overfittingçš„å¯èƒ½ä¸¦æé«˜robustness
        - é›–ç„¶æ­¤æ–¹æ³•ä¸é©ç”¨æ–¼å¤šæ¨£æ€§domainçš„caseï¼Œä½†å¯¦é©—è­‰æ˜æ¯æ¬¡ç”¢ç”Ÿä¸åŒçš„target histogramä»èƒ½å¸¶ä¾†è¼ƒå¥½çš„çµæœ
    
    ![æˆªåœ– 2021-10-07 ä¸‹åˆ2.27.28.png](../paper_resources/HistoGAN/æˆªåœ–_2021-10-07_ä¸‹åˆ2.27.28.png)
    

## 2.3. Image Recoloring

![æˆªåœ– 2021-10-07 ä¸‹åˆ3.31.43.png](../paper_resources/HistoGAN/æˆªåœ–_2021-10-07_ä¸‹åˆ3.31.43.png)

- æ“´å±•HistoGANçš„è¨­è¨ˆä¾†å°å·²çŸ¥çš„input $I_i$ é€²è¡Œè‘—è‰²
- ä¸¦éæƒ³åƒä¸­ç›´è§€ï¼Œå› ç‚ºåœ¨HistoGANä¸­æ§åˆ¶é¡è‰²çš„éƒ¨åˆ†æ˜¯éš±å«åœ¨modelè£¡é¢çš„ï¼ˆHistoGANçš„æœ€å¾Œå…©å€‹blockè² è²¬é¡è‰²ï¼‰
- ä¸ä½¿ç”¨å°noiseå’Œstyle vectoré€²è¡Œå„ªåŒ–ï¼Œè€Œæ˜¯è¨“ç·´ä¸€å€‹encoderï¼Œå°‡inputæ˜ å°„åˆ°HistoGANå¯ä»¥ä½¿ç”¨çš„input

### æ¶æ§‹

![æˆªåœ– 2021-10-07 ä¸‹åˆ3.38.46.png](../paper_resources/HistoGAN/æˆªåœ–_2021-10-07_ä¸‹åˆ3.38.46.png)

- é¡ä¼¼æ–¼U-netæœ‰å€‹skip connections
- ç‚ºäº†ä¿å­˜inputçš„ç´°ç¯€ï¼Œå› æ­¤æœƒä¿ç•™encoderå‰å…©å€‹blockçš„latent featureä¸¦é€éskip connectionsä¾†å‚³åˆ°HistoGANçš„é ­ä½œç‚ºç´°ç¯€input
- ä¿®æ”¹HistoGANçš„æ¶æ§‹
    - å¯ä»¥åœ¨æœ€é ­çš„åœ°æ–¹ä¸Ÿå…¥target histogram
    - é€éU-Netæ¶æ§‹ä¸­çš„skip connectionsä¾†å°‡å‰å…©å€‹encoderè¼¸å‡ºçš„feature mapï¼ˆhistogramçš„ç‰¹å¾µï¼‰ç›´æ¥æ”¾åˆ°å°¾å·´ï¼ˆHistoGANé–‹å§‹çš„åœ°æ–¹ï¼‰
    - æ­¤ä½œæ³•ï¼ˆåªå‚³å…¥å‰å…©å€‹blockçš„target histogramç‰¹å¾µï¼‰å¯ä»¥è®“æ¨¡å‹å­¸ç¿’åœ¨è‘—è‰²çš„æ­¥é©Ÿæ™‚åŒæ™‚è€ƒæ…®input image contentå’Œtarget histogramçš„é¡è‰²

### loss function

$\mathcal{L}=\beta R(I_i,I_r)+\gamma D(I_r)+\alpha C(H_r,H_t)$

- $R(\cdot)$ æ˜¯ä¸€å€‹reconstructçš„termç”¨ä¾†ä¿å­˜input contentçš„ç´°ç¯€
- reconstructçš„è¨ˆç®—æ–¹å¼æ˜¯ä½¿ç”¨L1 normä¾†è¨ˆç®—inputå’Œrecoloråœ–ç‰‡çš„å¾®åˆ†è·é›¢
- ReHistoGANæœ‰ä¸‰å¤§ç›®æ¨™
    1. èˆ‡ç›®æ¨™histogramæœ‰ç›¸è¿‘çš„é¡è‰²åˆ†ä½ˆ
    2. ç”Ÿæˆçš„çµæœè¦çœŸå¯¦
    3. èˆ‡input imageçš„contentè¦ä¸€æ¨£

# 3. Results and Discussion

# 4. Conclusion
